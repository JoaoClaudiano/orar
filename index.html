<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïØÔ∏è Orar - Orat√≥rio Virtual</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #4a148c 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            text-align: center; 
        }
        
        header { 
            padding: 40px 0; 
        }
        
        h1 { 
            font-size: 3rem; 
            color: #FFD54F; 
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle { 
            font-size: 1.2rem; 
            opacity: 0.9; 
            margin-bottom: 30px; 
        }
        
        .github-badge {
            display: inline-block;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .stat {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            min-width: 150px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s;
        }
        
        .stat:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            display: block;
            color: #FFD54F;
        }
        
        .candle-container {
            margin: 40px 0;
        }
        
        .candle {
            width: 60px;
            height: 100px;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .flame {
            width: 15px;
            height: 30px;
            background: linear-gradient(to bottom, #FF9800, #FF5722);
            border-radius: 50% 50% 20% 20%;
            margin: 0 auto;
            animation: flicker 1.5s infinite alternate;
            box-shadow: 0 0 20px #FF9800, 0 0 40px #FF9800;
        }
        
        .wax {
            width: 100%;
            height: 70px;
            background: linear-gradient(to right, #FFF8E1, #FFECB3);
            border-radius: 5px;
            margin-top: 5px;
        }
        
        @keyframes flicker {
            0%, 100% { 
                transform: scale(1); 
                opacity: 0.9; 
            }
            50% { 
                transform: scale(1.1); 
                opacity: 1; 
            }
        }
        
        .btn {
            background: linear-gradient(to right, #FFD54F, #FFB300);
            color: #333;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 213, 79, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 213, 79, 0.4);
        }
        
        .form-container {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            display: none;
            text-align: left;
            backdrop-filter: blur(10px);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            margin-top: 5px;
            font-size: 1rem;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #FFD54F;
            box-shadow: 0 0 10px rgba(255, 213, 79, 0.3);
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        @media (max-width: 600px) {
            h1 { 
                font-size: 2.2rem; 
            }
            .stats { 
                flex-direction: column; 
                align-items: center; 
            }
            .stat { 
                width: 100%; 
                max-width: 300px; 
            }
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üïØÔ∏è Orar</h1>
            <p class="subtitle">Orat√≥rio Virtual - Acenda sua vela de inten√ß√£o</p>
            <div class="github-badge">
                üåê <strong>orar</strong> | üî• <strong>orar-b23db</strong>
            </div>
        </header>
        
        <div class="stats">
            <div class="stat">
                <span class="stat-number" id="totalCandles">0</span>
                <span>Velas Acesas</span>
            </div>
            <div class="stat">
                <span class="stat-number" id="liveCandles">0</span>
                <span>Online Agora</span>
            </div>
            <div class="stat">
                <span class="stat-number" id="prayersToday">1,247</span>
                <span>Ora√ß√µes Hoje</span>
            </div>
        </div>
        
        <div class="candle-container">
            <div class="candle">
                <div class="flame"></div>
                <div class="wax"></div>
            </div>
            
            <button class="btn" id="lightCandleBtn">
                ‚ú® Acender uma Vela
            </button>
            
            <button class="btn" id="viewWallBtn" style="background: rgba(255,255,255,0.1); color: white;">
                üëÅÔ∏è Ver Mural de Ora√ß√µes
            </button>
        </div>
        
        <div id="candleForm" class="form-container">
            <h3 style="text-align: center; margin-bottom: 20px; color: #FFD54F;">
                Acender Vela Virtual
            </h3>
            
            <div class="form-group">
                <label for="intention">Sua Inten√ß√£o *</label>
                <textarea id="intention" placeholder="Escreva seu pedido, agradecimento ou inten√ß√£o de ora√ß√£o..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="forWho">Para quem √©?</label>
                <select id="forWho">
                    <option value="self">Para mim</option>
                    <option value="family">Para minha fam√≠lia</option>
                    <option value="friend">Para um amigo</option>
                    <option value="world">Pela paz no mundo</option>
                    <option value="memory">Em mem√≥ria</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="visibility">Visibilidade</label>
                <select id="visibility">
                    <option value="private">üîí Privada (s√≥ eu vejo)</option>
                    <option value="anonymous">üë§ An√¥nima (no mural sem nome)</option>
                    <option value="public">üåç P√∫blica (todos veem)</option>
                </select>
            </div>
            
            <div class="btn-group">
                <button class="btn" id="submitCandleBtn" style="flex: 1;">
                    ‚úÖ Acender Vela
                </button>
                <button class="btn" id="cancelBtn" style="background: rgba(255,255,255,0.1); color: white; flex: 1;">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
        
        <div style="margin: 40px 0;">
            <h3>‚ú® Como funciona?</h3>
            <div style="margin-top: 20px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto;">
                <p style="margin-bottom: 10px;">1. <strong>Escreva sua inten√ß√£o</strong> - Pode ser um pedido, agradecimento ou mem√≥ria</p>
                <p style="margin-bottom: 10px;">2. <strong>Escolha a privacidade</strong> - Privada, an√¥nima ou p√∫blica</p>
                <p style="margin-bottom: 10px;">3. <strong>Sua vela ficar√° acesa 7 dias</strong> - Simbolicamente no nosso orat√≥rio</p>
                <p style="margin-bottom: 10px;">4. <strong>Outros podem orar por voc√™</strong> - Se escolher p√∫blica ou an√¥nima</p>
            </div>
        </div>
        
        <footer>
            <p>Orar - Orat√≥rio Virtual ¬© 2024</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">
                Hospedado no GitHub: <strong>orar</strong> | 
                Firebase: <strong>orar-b23db</strong> | 
                Status: <span id="firebaseStatus" style="color: #4CAF50;">‚óè Conectado</span>
            </p>
        </footer>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase Configuration - CORRIGIDO
        const firebaseConfig = {
            apiKey: "AIzaSyDNDAOqdCVsk4w2aEdLR_ihsrhqASacDpw",
            authDomain: "orar-b23db.firebaseapp.com",
            projectId: "orar-b23db",
            storageBucket: "orar-b23db.firebasestorage.app",
            messagingSenderId: "552018175417",
            appId: "1:552018175417:web:fc7606ec957128685b4268",
            measurementId: "G-SMHCL4S3RY"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        console.log("‚úÖ Firebase inicializado: Projeto 'orar-b23db'");
        
        // Global variables - CORRETO (sem erro de atribui√ß√£o)
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseAuth = auth;
    </script>
    
    <!-- Main Application Logic -->
    <script>
        // DOM Elements
        const lightCandleBtn = document.getElementById('lightCandleBtn');
        const viewWallBtn = document.getElementById('viewWallBtn');
        const candleForm = document.getElementById('candleForm');
        const submitCandleBtn = document.getElementById('submitCandleBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const intentionInput = document.getElementById('intention');
        const forWhoSelect = document.getElementById('forWho');
        const visibilitySelect = document.getElementById('visibility');
        
        // Initialize Firebase connection
        function initFirebase() {
            try {
                // Test Firebase connection
                if (window.firebaseDb) {
                    console.log("Firebase conectado com sucesso!");
                    
                    // Listen for real-time candle count
                    const candlesRef = firebase.firestore().collection('candles');
                    
                    candlesRef.onSnapshot((snapshot) => {
                        const count = snapshot.size;
                        document.getElementById('totalCandles').textContent = count;
                        document.getElementById('liveCandles').textContent = Math.max(1, Math.floor(count / 3));
                    });
                    
                    // Update status
                    document.getElementById('firebaseStatus').textContent = '‚óè Conectado';
                    document.getElementById('firebaseStatus').style.color = '#4CAF50';
                    
                    return true;
                }
            } catch (error) {
                console.error("Erro ao conectar ao Firebase:", error);
                document.getElementById('firebaseStatus').textContent = '‚óã Erro de conex√£o';
                document.getElementById('firebaseStatus').style.color = '#f44336';
                return false;
            }
        }
        
        // Show candle form
        function showCandleForm() {
            candleForm.style.display = 'block';
            window.scrollTo({
                top: candleForm.offsetTop - 50,
                behavior: 'smooth'
            });
            intentionInput.focus();
        }
        
        // Hide candle form
        function hideCandleForm() {
            candleForm.style.display = 'none';
            intentionInput.value = '';
        }
        
        // Submit candle to Firebase
        async function submitCandle() {
            const intention = intentionInput.value.trim();
            
            if (!intention) {
                alert('Por favor, escreva sua inten√ß√£o de ora√ß√£o.');
                return;
            }
            
            if (intention.length < 5) {
                alert('Sua inten√ß√£o precisa ter pelo menos 5 caracteres.');
                return;
            }
            
            try {
                // Check Firebase connection
                if (!window.firebaseDb) {
                    throw new Error("Firebase n√£o est√° conectado");
                }
                
                // Prepare candle data
                const candleData = {
                    intention: intention,
                    forWho: forWhoSelect.value,
                    visibility: visibilitySelect.value,
                    createdAt: new Date().toISOString(),
                    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(), // 7 days
                    prayerCount: 0,
                    isActive: true
                };
                
                // Save to Firestore
                const docRef = await firebase.firestore()
                    .collection('candles')
                    .add(candleData);
                
                console.log("Vela salva com ID:", docRef.id);
                
                // Animation effect
                const flame = document.querySelector('.flame');
                flame.style.animation = 'none';
                setTimeout(() => {
                    flame.style.animation = 'flicker 1.5s infinite alternate';
                    flame.style.boxShadow = '0 0 30px #FF9800, 0 0 50px #FF9800';
                }, 10);
                
                // Success message
                const messages = [
                    "Sua vela foi acesa com sucesso! ‚ú®",
                    "Sua inten√ß√£o est√° em nossas ora√ß√µes. üôè",
                    "Que sua luz ilumine muitos cora√ß√µes. üíõ",
                    "Sua f√© conecta voc√™ a milhares. üåç"
                ];
                
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                alert(`‚úÖ ${randomMessage}\n\n"${intention.substring(0, 60)}${intention.length > 60 ? '...' : ''}"`);
                
                // Reset form
                hideCandleForm();
                
            } catch (error) {
                console.error("Erro ao salvar vela:", error);
                
                // Fallback: simulate success if Firebase fails
                if (error.message.includes("permission") || error.message.includes("Firebase")) {
                    alert("‚ö†Ô∏è Modo offline ativado\n\nSua vela foi acesa localmente. Quando a conex√£o voltar, ela ser√° sincronizada.");
                    
                    // Local storage fallback
                    const localCandles = JSON.parse(localStorage.getItem('orar_candles') || '[]');
                    localCandles.push({
                        intention: intention,
                        forWho: forWhoSelect.value,
                        visibility: visibilitySelect.value,
                        createdAt: new Date().toISOString()
                    });
                    localStorage.setItem('orar_candles', JSON.stringify(localCandles));
                    
                    // Update counter locally
                    const currentCount = parseInt(document.getElementById('totalCandles').textContent) || 0;
                    document.getElementById('totalCandles').textContent = currentCount + 1;
                    
                    hideCandleForm();
                } else {
                    alert("Erro ao salvar sua vela. Por favor, tente novamente.");
                }
            }
        }
        
        // View prayer wall
        function viewWall() {
            alert('üß± Mural de Ora√ß√µes\n\nEm breve voc√™ ver√° aqui todas as velas p√∫blicas acesas por pessoas ao redor do mundo!\n\nüåü Funcionalidade em desenvolvimento...');
        }
        
        // Update prayers today counter
        function updatePrayersToday() {
            const now = new Date();
            const hour = now.getHours();
            // Simulate growing prayers throughout the day
            const basePrayers = 1000;
            const prayers = basePrayers + (hour * 42);
            document.getElementById('prayersToday').textContent = prayers.toLocaleString();
        }
        
        // Event Listeners
        lightCandleBtn.addEventListener('click', showCandleForm);
        viewWallBtn.addEventListener('click', viewWall);
        submitCandleBtn.addEventListener('click', submitCandle);
        cancelBtn.addEventListener('click', hideCandleForm);
        
        // Allow Enter key in textarea
        intentionInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                submitCandle();
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Firebase
            initFirebase();
            
            // Update counters
            updatePrayersToday();
            setInterval(updatePrayersToday, 60000); // Update every minute
            
            // Animate flame periodically
            setInterval(() => {
                const flame = document.querySelector('.flame');
                flame.style.animation = 'none';
                setTimeout(() => {
                    flame.style.animation = 'flicker 1.5s infinite alternate';
                }, 100);
            }, 10000);
            
            // Check for locally stored candles
            const localCandles = JSON.parse(localStorage.getItem('orar_candles') || '[]');
            if (localCandles.length > 0) {
                console.log(`${localCandles.length} velas armazenadas localmente`);
            }
        });
    </script>
</body>
</html>
