<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üïØÔ∏è Orar - Orat√≥rio Virtual</title>
    <!-- Firebase j√° configurado - SEU projeto "Orar" -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        // SUAS credenciais Firebase - Projeto "Orar" (projectId: orar-b23db)
        const firebaseConfig = {
            apiKey: "AIzaSyDNDAOqdCVsk4w2aEdLR_ihsrhqASacDpw",
            authDomain: "orar-b23db.firebaseapp.com",
            projectId: "orar-b23db",  // ‚Üê Isto conecta ao SEU projeto!
            storageBucket: "orar-b23db.firebasestorage.app",
            messagingSenderId: "552018175417",
            appId: "1:552018175417:web:fc7606ec957128685b4268",
            measurementId: "G-SMHCL4S3RY"
        };
        
        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        
        console.log("‚úÖ Conectado ao Firebase: Projeto 'Orar' (orar-b23db)");
        
        // Login an√¥nimo autom√°tico
        signInAnonymously(auth).catch(console.error);
        
        // Exportar para uso global
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseAuth = auth;
        
        // Contar velas em tempo real
        onSnapshot(collection(db, "candles"), (snapshot) => {
            const count = snapshot.size;
            document.getElementById('totalCandles')?.textContent = count;
            document.getElementById('liveCandles')?.textContent = Math.max(1, Math.floor(count / 10));
        });
        
        // Fun√ß√£o para salvar vela
        window.saveCandle = async (data) => {
            try {
                const docRef = await addDoc(collection(db, "candles"), {
                    ...data,
                    createdAt: new Date().toISOString(),
                    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                    prayerCount: 0,
                    userId: auth.currentUser?.uid || 'anonymous'
                });
                return docRef.id;
            } catch (error) {
                console.error("Erro ao salvar:", error);
                throw error;
            }
        };
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #4a148c 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; text-align: center; }
        header { padding: 40px 0; }
        h1 { font-size: 3rem; color: #FFD54F; margin-bottom: 10px; }
        .subtitle { font-size: 1.2rem; opacity: 0.9; margin-bottom: 30px; }
        
        .stats {
            display: flex; justify-content: center; gap: 20px; margin: 30px 0;
            flex-wrap: wrap;
        }
        .stat {
            background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;
            min-width: 150px;
        }
        .stat-number { font-size: 2rem; font-weight: bold; display: block; color: #FFD54F; }
        
        .candle-container {
            margin: 40px 0;
        }
        .candle {
            width: 60px; height: 100px; margin: 0 auto 20px; position: relative;
        }
        .flame {
            width: 15px; height: 30px; background: #FF9800;
            border-radius: 50% 50% 20% 20%; margin: 0 auto;
            animation: flicker 1.5s infinite alternate;
            box-shadow: 0 0 20px #FF9800;
        }
        .wax {
            width: 100%; height: 70px; background: #FFF8E1;
            border-radius: 5px; margin-top: 5px;
        }
        @keyframes flicker {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        
        .btn {
            background: #FFD54F; color: #333; border: none;
            padding: 15px 30px; font-size: 1.1rem; border-radius: 50px;
            cursor: pointer; font-weight: bold; margin: 10px;
            transition: transform 0.3s;
        }
        .btn:hover { transform: translateY(-3px); }
        
        .form-container {
            background: rgba(255,255,255,0.1); padding: 30px;
            border-radius: 15px; margin: 30px 0; display: none;
            text-align: left;
        }
        .form-group { margin-bottom: 20px; }
        input, select, textarea {
            width: 100%; padding: 12px; border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1); color: white;
            margin-top: 5px;
        }
        textarea { min-height: 100px; resize: vertical; }
        
        footer {
            margin-top: 50px; padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 0.9rem; opacity: 0.7;
        }
        
        @media (max-width: 600px) {
            h1 { font-size: 2.2rem; }
            .stats { flex-direction: column; align-items: center; }
            .stat { width: 100%; max-width: 300px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üïØÔ∏è Orar</h1>
            <p class="subtitle">Orat√≥rio Virtual - Acenda sua vela de inten√ß√£o</p>
            <p style="font-size: 0.9rem; opacity: 0.8;">
                Reposit√≥rio: <strong>orar</strong> | Firebase: <strong>Orar (orar-b23db)</strong>
            </p>
        </header>
        
        <div class="stats">
            <div class="stat">
                <span class="stat-number" id="totalCandles">0</span>
                <span>Velas Acesas</span>
            </div>
            <div class="stat">
                <span class="stat-number" id="liveCandles">0</span>
                <span>Online Agora</span>
            </div>
            <div class="stat">
                <span class="stat-number" id="prayersToday">0</span>
                <span>Ora√ß√µes Hoje</span>
            </div>
        </div>
        
        <div class="candle-container">
            <div class="candle">
                <div class="flame"></div>
                <div class="wax"></div>
            </div>
            
            <button class="btn" onclick="showForm()">
                ‚ú® Acender uma Vela
            </button>
            
            <button class="btn" onclick="viewWall()" style="background: rgba(255,255,255,0.1); color: white;">
                üëÅÔ∏è Ver Mural
            </button>
        </div>
        
        <div id="form" class="form-container">
            <h3 style="text-align: center; margin-bottom: 20px; color: #FFD54F;">
                Acender Vela Virtual
            </h3>
            
            <div class="form-group">
                <label>Sua Inten√ß√£o *</label>
                <textarea id="intention" placeholder="Escreva seu pedido, agradecimento ou inten√ß√£o de ora√ß√£o..."></textarea>
            </div>
            
            <div class="form-group">
                <label>Para quem √©?</label>
                <select id="forWho">
                    <option value="self">Para mim</option>
                    <option value="family">Para minha fam√≠lia</option>
                    <option value="friend">Para um amigo</option>
                    <option value="world">Pela paz no mundo</option>
                    <option value="memory">Em mem√≥ria</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Visibilidade</label>
                <select id="visibility">
                    <option value="private">üîí Privada (s√≥ eu vejo)</option>
                    <option value="anonymous">üë§ An√¥nima (no mural sem nome)</option>
                    <option value="public">üåç P√∫blica (todos veem)</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 30px;">
                <button class="btn" onclick="submitCandle()" style="flex: 1;">
                    ‚úÖ Acender Vela
                </button>
                <button class="btn" onclick="hideForm()" style="background: rgba(255,255,255,0.1); color: white; flex: 1;">
                    ‚ùå Cancelar
                </button>
            </div>
        </div>
        
        <div style="margin: 40px 0;">
            <h3>Como funciona?</h3>
            <p style="margin-top: 15px; opacity: 0.9;">
                1. Escreva sua inten√ß√£o<br>
                2. Sua vela ficar√° acesa por 7 dias<br>
                3. Voc√™ pode escolher privacidade<br>
                4. Outros podem orar por sua inten√ß√£o
            </p>
        </div>
        
        <footer>
            <p>Orar - Orat√≥rio Virtual ¬© 2024</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">
                Hospedado no GitHub: <strong>orar</strong><br>
                Backend: Firebase <strong>Orar (orar-b23db)</strong><br>
                Status: <span id="firebaseStatus" style="color: #4CAF50;">‚óè Conectado</span>
            </p>
        </footer>
    </div>
    
    <script>
        // Contador de ora√ß√µes hoje
        function updatePrayersToday() {
            const now = new Date();
            const hour = now.getHours();
            const prayers = Math.floor(1000 + hour * 42);
            document.getElementById('prayersToday').textContent = prayers;
        }
        setInterval(updatePrayersToday, 60000);
        updatePrayersToday();
        
        // Fun√ß√µes do formul√°rio
        function showForm() {
            document.getElementById('form').style.display = 'block';
            window.scrollTo({ top: document.getElementById('form').offsetTop - 50, behavior: 'smooth' });
        }
        
        function hideForm() {
            document.getElementById('form').style.display = 'none';
            document.getElementById('intention').value = '';
        }
        
        async function submitCandle() {
            const intention = document.getElementById('intention').value.trim();
            if (!intention) {
                alert('Por favor, escreva sua inten√ß√£o.');
                return;
            }
            
            const candleData = {
                intention: intention,
                forWho: document.getElementById('forWho').value,
                visibility: document.getElementById('visibility').value,
                timestamp: new Date().toLocaleString('pt-BR')
            };
            
            try {
                // Usar a fun√ß√£o do Firebase
                if (window.saveCandle) {
                    await window.saveCandle(candleData);
                    
                    // Anima√ß√£o da vela
                    const flame = document.querySelector('.flame');
                    flame.style.animation = 'none';
                    setTimeout(() => {
                        flame.style.animation = 'flicker 1.5s infinite alternate';
                        flame.style.boxShadow = '0 0 30px #FF9800';
                    }, 10);
                    
                    // Mensagem de sucesso
                    alert(`Vela acesa com sucesso!\n\n"${intention.substring(0, 50)}..."\n\nSua inten√ß√£o est√° em nossas ora√ß√µes.`);
                    
                    hideForm();
                } else {
                    alert('Aguarde, Firebase ainda n√£o carregou...');
                }
            } catch (error) {
                console.error(error);
                alert('Erro ao salvar. Verifique o console para detalhes.');
            }
        }
        
        function viewWall() {
            alert('Mural de Ora√ß√µes em breve! üöÄ\n\nAqui voc√™ ver√° todas as velas p√∫blicas acesas.');
        }
        
        // Verificar status do Firebase
        setTimeout(() => {
            if (!window.firebaseDb) {
                document.getElementById('firebaseStatus').textContent = '‚óã Desconectado';
                document.getElementById('firebaseStatus').style.color = '#f44336';
            }
        }, 3000);
    </script>
</body>
</html>
